---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name kometa-secret
spec:
  secretStoreRef:
    name: bitwarden-secrets-manager
    kind: ClusterSecretStore
  target:
    name: *name
    template:
      engineVersion: v2
      data:
        # Kometa-specific API keys
        KOMETA_MDBLIST_API_KEY: "{{ .Kometa__MdblistApiKey }}"
        KOMETA_OMDB_API_KEY: "{{ .Kometa__OmdbApiKey }}"
        KOMETA_TMDB_API_KEY: "{{ .Kometa__TmdbApiKey }}"
        # MyAnimeList OAuth
        KOMETA_MYANIMELIST_CLIENT_ID: "{{ .Kometa__MyAnimeList__ClientId }}"
        KOMETA_MYANIMELIST_CLIENT_SECRET: "{{ .Kometa__MyAnimeList__ClientSecret }}"
        KOMETA_MYANIMELIST_ACCESS_TOKEN: "{{ .Kometa__MyAnimeList__AccessToken }}"
        KOMETA_MYANIMELIST_REFRESH_TOKEN: "{{ .Kometa__MyAnimeList__RefreshToken }}"
        KOMETA_MYANIMELIST_EXPIRES_IN: "{{ .Kometa__MyAnimeList__ExpiresIn }}"
        KOMETA_MYANIMELIST_LOCALHOST_URL: "{{ .Kometa__MyAnimeList__LocalhostUrl }}"
        # Trakt OAuth
        KOMETA_TRAKT_CLIENT_ID: "{{ .Kometa__Trakt__ClientId }}"
        KOMETA_TRAKT_CLIENT_SECRET: "{{ .Kometa__Trakt__ClientSecret }}"
        KOMETA_TRAKT_ACCESS_TOKEN: "{{ .Kometa__Trakt__AccessToken }}"
        KOMETA_TRAKT_REFRESH_TOKEN: "{{ .Kometa__Trakt__RefreshToken }}"
        KOMETA_TRAKT_EXPIRES_IN: "{{ .Kometa__Trakt__ExpiresIn }}"
        KOMETA_TRAKT_CREATED_AT: "{{ .Kometa__Trakt__CreatedAt }}"
        # Shared API keys from other apps
        KOMETA_PLEX_API_KEY: "{{ .Plex__Token }}"
        KOMETA_TAUTULLI_API_KEY: "{{ .Tautulli__ApiKey }}"
        KOMETA_RADARR_API_KEY: "{{ .Radarr__ApiKey }}"
        KOMETA_SONARR_API_KEY: "{{ .Sonarr__ApiKey }}"
  dataFrom:
    - extract:
        key: kometa
    - extract:
        key: plex
    - extract:
        key: tautulli
    - extract:
        key: radarr
    - extract:
        key: sonarr
