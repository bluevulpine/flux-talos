---
apiVersion: v1
kind: Service
metadata:
  name: dev-ubuntu
  namespace: default
  labels:
    app.kubernetes.io/name: dev-ubuntu
    app.kubernetes.io/instance: dev-ubuntu
spec:
  type: ClusterIP
  ports:
    - port: 22
      targetPort: ssh
      protocol: TCP
      name: ssh
  selector:
    app.kubernetes.io/name: dev-ubuntu
    app.kubernetes.io/instance: dev-ubuntu
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: dev-ubuntu-scripts
  namespace: default
data:
  setup-dev-tools.sh: |
    #!/bin/bash
    # Additional development tools setup script
    # Run this after the pod is ready for additional tools
    
    # Source Homebrew environment
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
    
    # Install common development tools via Homebrew
    brew install \
      gh \
      kubectl \
      helm \
      docker \
      docker-compose \
      node \
      python \
      go \
      rust \
      terraform \
      ansible \
      jq \
      yq \
      fzf \
      ripgrep \
      bat \
      exa \
      fd \
      delta \
      lazygit \
      neovim
    
    # Install additional ZSH plugins
    git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
    git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
    
    # Update .zshrc with plugins
    sed -i 's/plugins=(git)/plugins=(git zsh-autosuggestions zsh-syntax-highlighting kubectl helm docker)/' ~/.zshrc
    
    echo "Development tools installation complete!"
    echo "Restart your shell or run 'source ~/.zshrc' to apply changes"
  
  backup-dev-env.sh: |
    #!/bin/bash
    # Backup development environment
    # This can be run periodically to backup configurations
    
    BACKUP_DIR="/home/dev/backups/$(date +%Y%m%d_%H%M%S)"
    mkdir -p "$BACKUP_DIR"
    
    # Backup important configurations
    cp ~/.zshrc "$BACKUP_DIR/"
    cp ~/.gitconfig "$BACKUP_DIR/" 2>/dev/null || true
    cp ~/.ssh/config "$BACKUP_DIR/" 2>/dev/null || true
    
    # Backup Homebrew package list
    /home/linuxbrew/.linuxbrew/bin/brew list > "$BACKUP_DIR/brew_packages.txt"
    
    # Create archive
    tar -czf "/home/dev/backups/dev-env-$(date +%Y%m%d_%H%M%S).tar.gz" -C "$BACKUP_DIR" .
    
    echo "Backup created: /home/dev/backups/dev-env-$(date +%Y%m%d_%H%M%S).tar.gz"
