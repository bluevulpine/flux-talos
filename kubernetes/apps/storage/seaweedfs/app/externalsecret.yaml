---
# ExternalSecret for SeaweedFS S3 MinIO credentials
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: seaweedfs-s3-secret
spec:
  secretStoreRef:
    name: bitwarden-secrets-manager
    kind: ClusterSecretStore
  target:
    name: seaweedfs-s3-secret
    template:
      engineVersion: v2
      data:
        # SeaweedFS S3 authentication configuration
        seaweedfs_s3_config: |
          {
            "identities": [
              {
                "name": "minio",
                "credentials": [
                  {
                    "accessKey": "{{ .Minio__RootUser }}",
                    "secretKey": "{{ .Minio__RootPass }}"
                  }
                ],
                "actions": ["Admin", "Read", "Write"]
              }
            ]
          }
        # AWS CLI credentials for bucket creation job
        AWS_ACCESS_KEY_ID: "{{ .Minio__RootUser }}"
        AWS_SECRET_ACCESS_KEY: "{{ .Minio__RootPass }}"
  dataFrom:
    - extract:
        key: minio
