---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: valheim-volsync-syncthing
spec:
  secretStoreRef:
    name: bitwarden-secrets-manager
    kind: ClusterSecretStore
  target:
    # This secret is used for Flux substituteFrom in the main valheim ks.yaml
    # to provide SYNCTHING_REMOTE_DEVICE_ID and SYNCTHING_REMOTE_ADDRESS
    name: valheim-volsync-syncthing-secret
    template:
      engineVersion: v2
      data:
        # Remote Syncthing peer configuration
        # Device ID is the unique identifier for the remote Syncthing instance
        # Format: XXXXXXX-XXXXXXX-XXXXXXX-XXXXXXX-XXXXXXX-XXXXXXX-XXXXXXX-XXXXXXX
        SYNCTHING_REMOTE_DEVICE_ID: "{{ .Syncthing__RemoteDeviceId }}"
        # Remote host address (IP or hostname, without tcp:// prefix or port)
        SYNCTHING_REMOTE_ADDRESS: "{{ .Syncthing__RemoteAddress }}"
        # Remote port (defaults to 22000 if not specified in Bitwarden)
        SYNCTHING_REMOTE_PORT: "{{ .Syncthing__RemotePort | default \"22000\" }}"
  dataFrom:
    - extract:
        key: syncthing

